Неоптимізована квері погана тим, що ми робимо JOIN великих таблиць. Фільтрація та агрегація після цих JOIN, що також погано, бо таким чином купа різних дій. В висновку ми маємо погану навантаженність на пам'ять та виконання.

Я створила CTE і відсіюю на початку непотрібні колонки, тепер обробляються лише вони. Далі я роблю агрегацію на вже відфільтрованих даних, бо так це займає менше часу, пам'яті.

Далі я приєдную агреговані дані і таким чином я маю лише ті рядки які були заранішнє відфільровані і це швидше.
